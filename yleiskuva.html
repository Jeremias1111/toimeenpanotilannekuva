<!doctype html>
<html lang="fi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Toimeenpanotilannekuva – Yleiskuva</title>

  <style>
    @font-face{
      font-family:"OwalMark";
      src:
        local("MarkOffcPro"), local("MarkOffcPro-Regular"), local("MarkOffcPro-ExtraLight"),
        local("MarkOffcPro-Light"), local("MarkOffcPro-Medium"), local("MarkOffcPro-Bold"),
        local("MarkOffcPro-Black"), local("MarkOffcPro-Heavy"),
        local("MarkScOffcPro"), local("MarkScOffcPro-Regular"), local("MarkScOffcPro-ExtraLight"),
        local("MarkScOffcPro-Light"), local("MarkScOffcPro-Medium"), local("MarkScOffcPro-Bold"),
        local("MarkScOffcPro-Black"), local("MarkScOffcPro-Heavy");
      font-weight:100 900;
      font-style:normal;
      font-display:swap;
    }

    :root{
      --orange:#FF9900;
      --orangeRed:#FF6633;
      --orangeL:#FFF2E8;
      --text:#141414;
      --muted:#6A6A6A;
      --line:#E7E7E7;
      --panel:#F7F7F7;
      --panel2:#F2F2F2;
      --white:#fff;

      --radius:18px;
      --shadow:0 2px 0 rgba(0,0,0,.02);

      --fw-regular:400;
      --fw-medium:600;
      --fw-bold:700;
      --fw-heavy:900;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:"OwalMark",system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;
      font-weight:var(--fw-regular);
      color:var(--text);
      background:linear-gradient(180deg, #fff 0%, #fff 62%, #fafafa 100%);
    }

    /* Topbar */
    .topbar{
      position:sticky; top:0; z-index:50;
      background:rgba(255,255,255,.92);
      backdrop-filter:saturate(140%) blur(10px);
      border-bottom:1px solid var(--line);
      padding:14px 22px 12px 22px;
    }
    .topbar::after{
      content:"";
      display:block;
      height:4px;
      background:linear-gradient(90deg, var(--orange), var(--orangeRed));
      margin:12px -22px -12px -22px;
    }
    .brandRow{display:flex;align-items:center;gap:16px;flex-wrap:wrap}
    .logo{display:flex;align-items:center;text-decoration:none;padding:6px 8px;border-radius:14px}
    .logo:hover{background:var(--panel)}
    .logo img{height:34px;width:auto;display:block}
    .titleWrap{flex:1;min-width:280px}
    .title{margin:0;font-size:22px;font-weight:var(--fw-heavy);letter-spacing:-.2px}
    .subtitle{margin:6px 0 0 0;color:var(--muted);font-size:13px;line-height:1.35}

    .nav{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-top:10px}
    .pill{
      display:inline-flex;align-items:center;gap:8px;
      padding:8px 12px;border-radius:999px;
      border:1px solid var(--line);
      background:var(--panel2);
      font-size:12px;font-weight:var(--fw-medium);
      text-decoration:none;color:var(--text);
      user-select:none;
    }
    .pill.on{background:var(--orangeL);border-color:rgba(255,153,0,.65)}
    .wrap{max-width:1280px;margin:0 auto;padding:18px 22px 70px 22px}

    /* Filters bar */
    .filters{
      margin-top:12px;
      display:flex; gap:10px; flex-wrap:wrap; align-items:center;
      padding:12px;
      border:1px solid var(--line);
      border-radius:18px;
      background:#fff;
      box-shadow:var(--shadow);
    }
    .search{
      flex:1; min-width:240px;
      display:flex; align-items:center; gap:10px;
      border:1px solid var(--line);
      border-radius:999px;
      padding:10px 12px;
      background:var(--panel);
    }
    .search input{
      border:none; outline:none; width:100%;
      background:transparent;
      font-family:inherit;
      font-size:13px;
    }
    .select{
      border:1px solid var(--line);
      border-radius:999px;
      padding:10px 12px;
      background:#fff;
      font-family:inherit;
      font-size:13px;
    }
    .seg{
      display:flex; gap:8px; flex-wrap:wrap;
      align-items:center;
    }
    .chipBtn{
      padding:8px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      background:var(--panel2);
      font-size:12px;
      font-weight:var(--fw-medium);
      cursor:pointer;
      user-select:none;
    }
    .chipBtn.on{
      background:var(--orangeL);
      border-color:rgba(255,153,0,.65);
    }

    /* Layout: 3 panels like mockup */
    .grid{
      display:grid;
      grid-template-columns: 360px 1fr 420px;
      gap:14px;
      margin-top:14px;
      align-items:start;
    }
    @media (max-width:1200px){
      .grid{grid-template-columns: 1fr}
    }

    .card{
      background:#fff;
      border:1px solid var(--line);
      border-radius:18px;
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    .cardHeader{
      padding:14px 16px;
      border-bottom:1px solid var(--line);
      background:linear-gradient(180deg,#fff 0%, #fafafa 100%);
    }
    .cardBody{padding:14px 16px}
    .h2{margin:0;font-size:16px;font-weight:var(--fw-bold);letter-spacing:-.1px}
    .hint{margin:8px 0 0 0;color:var(--muted);font-size:13px;line-height:1.35}

    /* Left list (12 kk) */
    .list{display:flex;flex-direction:column;gap:10px}
    .item{
      border:1px solid var(--line);
      border-radius:14px;
      padding:12px;
      background:#fff;
      cursor:pointer;
      transition:transform .06s ease;
    }
    .item:hover{transform:translateY(-1px)}
    .itemTop{display:flex;justify-content:space-between;gap:10px;align-items:flex-start}
    .itemTitle{font-weight:var(--fw-bold);font-size:13px;line-height:1.25}
    .itemMeta{margin-top:6px;color:var(--muted);font-size:12px;line-height:1.35}
    .tagRow{margin-top:8px;display:flex;gap:6px;flex-wrap:wrap}
    .tag{
      font-size:11px;
      border:1px solid var(--line);
      background:var(--panel2);
      color:var(--muted);
      padding:4px 8px;
      border-radius:999px;
      font-weight:var(--fw-medium);
    }

    /* Intensity pill 1–5 */
    .score{
      min-width:56px;
      text-align:center;
      border-radius:999px;
      padding:6px 10px;
      font-size:12px;
      font-weight:var(--fw-bold);
      border:1px solid rgba(255,153,0,.45);
      background:var(--orangeL);
      color:#8a3a00;
    }
    .score.high{
      border-color:rgba(255,102,51,.55);
      background:linear-gradient(180deg, rgba(255,102,51,.18), #fff);
      color:#8a1f00;
    }
    .score.low{
      border-color:var(--line);
      background:#fff;
      color:var(--muted);
    }

    /* Middle: 24 kk timeline bars */
    .timeline{
      display:grid;
      grid-template-columns: 70px 1fr;
      gap:10px;
      align-items:center;
    }
    .rowLabel{font-size:12px;color:var(--muted);font-weight:var(--fw-bold)}
    .bars{display:grid;grid-template-columns: repeat(8, 1fr); gap:8px}
    .qbar{
      border:1px solid var(--line);
      border-radius:14px;
      background:var(--panel2);
      height:84px;
      padding:10px;
      display:flex;
      flex-direction:column;
      justify-content:space-between;
      cursor:pointer;
    }
    .qbar.on{outline:3px solid rgba(255,153,0,.22)}
    .qbar .q{font-size:12px;font-weight:var(--fw-bold)}
    .qbar .v{font-size:14px;font-weight:var(--fw-heavy);letter-spacing:-.2px}
    .qbar.low{background:#fff}
    .qbar.mid{background:linear-gradient(180deg, var(--orangeL), #fff); border-color:rgba(255,153,0,.35)}
    .qbar.high{background:linear-gradient(180deg, rgba(255,102,51,.18), #fff); border-color:rgba(255,102,51,.45)}
    .qbar .sub{font-size:11px;color:var(--muted);font-weight:var(--fw-medium)}

    /* Right: heatmap "now" */
    .heatTop{display:flex;justify-content:space-between;gap:10px;align-items:flex-end;flex-wrap:wrap}
    .heatNote{color:var(--muted);font-size:12px;line-height:1.35}
    .heat{
      margin-top:12px;
      display:grid;
      grid-template-columns: 120px repeat(5, 1fr);
      gap:8px;
      align-items:stretch;
    }
    .heat .h{font-size:11px;color:var(--muted);font-weight:var(--fw-bold);padding:6px 0}
    .heat .r{font-size:12px;color:var(--muted);font-weight:var(--fw-bold);display:flex;align-items:center}
    .cell{
      border:1px solid var(--line);
      border-radius:14px;
      background:var(--panel2);
      height:44px;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:var(--fw-heavy);
      letter-spacing:-.2px;
      cursor:pointer;
      user-select:none;
    }
    .cell.low{background:#fff}
    .cell.mid{background:linear-gradient(180deg, var(--orangeL), #fff); border-color:rgba(255,153,0,.35)}
    .cell.high{background:linear-gradient(180deg, rgba(255,102,51,.18), #fff); border-color:rgba(255,102,51,.45)}
    .cell.on{outline:3px solid rgba(255,153,0,.22)}

    /* Side drill (under heatmap) */
    .drill{
      margin-top:12px;
      border-top:1px solid var(--line);
      padding-top:12px;
    }
    .drillTitle{font-weight:var(--fw-bold);font-size:13px}
    .drillList{margin-top:8px;display:flex;flex-direction:column;gap:6px}
    .drillItem{font-size:12px;color:var(--text)}
    .drillItem small{color:var(--muted)}
    a{color:inherit;text-decoration:none}
    a:hover{text-decoration:underline}

    .loading{
      border:1px solid var(--line);
      border-radius:14px;
      background:var(--panel);
      padding:12px;
      color:var(--muted);
      font-size:13px;
    }

    .footer{
      margin-top:22px;
      padding-top:16px;
      border-top:1px solid var(--line);
      color:var(--muted);
      font-size:12px;
      display:flex;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
    }
  </style>
</head>

<body>
  <div class="topbar">
    <div class="brandRow">
      <a class="logo" href="./yleiskuva.html" aria-label="Owal Group">
        <img src="./assets/owal_logo.png" alt="Owal Group logo" />
      </a>
      <div class="titleWrap">
        <div class="title">Uudistuskuorman seuranta</div>
        <div class="subtitle">Selkeä yleiskuva (12 kk + 24 kk + kartta nyt). Tarkennukset uudistusnäkymässä.</div>
      </div>
    </div>

    <div class="nav">
      <a class="pill on" href="./yleiskuva.html">Yleiskuva</a>
      <a class="pill" href="./index.html?id=pkg-001">Uudistusnäkymä</a>
      <a class="pill" href="./hallinnonalat.html">Hallinnonalat</a>
    </div>
  </div>

  <div class="wrap">
    <div class="filters">
      <div class="search">
        <span style="font-weight:var(--fw-bold);color:var(--muted)">Hae</span>
        <input id="q" placeholder="esim. työllisyys, data, sote…" />
      </div>

      <select id="sector" class="select" title="Sektori">
        <option value="">Sektori: Kaikki</option>
        <option value="SOTE">SOTE</option>
        <option value="Koulutus">Koulutus</option>
        <option value="Työllisyys">Työllisyys</option>
        <option value="Ilmasto">Ilmasto</option>
        <option value="Digitalisaatio">Digitalisaatio</option>
      </select>

      <div class="seg" aria-label="Kohdistus">
        <span class="chipBtn on" data-scope="">Kaikki</span>
        <span class="chipBtn" data-scope="Kunnat">Kunnat</span>
        <span class="chipBtn" data-scope="Hyvinvointialueet">Hyvinvointialueet</span>
        <span class="chipBtn" data-scope="Valtio">Valtio</span>
      </div>
    </div>

    <div class="grid">
      <!-- Left: 12 kk list -->
      <div class="card">
        <div class="cardHeader">
          <div class="h2">Uudistukset (12 kk)</div>
          <div class="hint">Klikkaa korttia → avaa uudistusnäkymä.</div>
        </div>
        <div class="cardBody">
          <div id="list" class="loading">Ladataan…</div>
        </div>
      </div>

      <!-- Middle: 24 kk timeline -->
      <div class="card">
        <div class="cardHeader">
          <div class="h2">Aikajana (24 kk)</div>
          <div class="hint">Kvartaaleittain: samanaikaisuus kunnille ja hyvinvointialueille.</div>
        </div>
        <div class="cardBody">
          <div id="timeline" class="loading">Ladataan…</div>
        </div>
      </div>

      <!-- Right: heatmap now -->
      <div class="card">
        <div class="cardHeader">
          <div class="heatTop">
            <div>
              <div class="h2">Kartta (nyt)</div>
              <div class="hint">Sektori × kohdistus. Klikkaa solua → näytä, mistä koostuu.</div>
            </div>
            <div class="heatNote" id="nowLabel">—</div>
          </div>
        </div>
        <div class="cardBody">
          <div id="heat" class="loading">Ladataan…</div>
          <div class="drill">
            <div class="drillTitle" id="drillTitle">Valitse solu kartasta</div>
            <div class="drillList" id="drillList"></div>
          </div>
        </div>
      </div>
    </div>

    <div class="footer">
      <div>Owal Group • päätöksenteon ja toimeenpanon tuki</div>
      <div>Lisää paketit: muokkaa <b>PACKAGES</b>-listaa tiedoston lopussa.</div>
    </div>
  </div>

  <script>
    // MVP: listaa paketit manuaalisesti
    const PACKAGES = ["pkg-001", "pkg-002"];
    const DATA_DIR = "./data/";

    const $ = (id) => document.getElementById(id);

    function uniq(arr){ return [...new Set((arr||[]).filter(Boolean))]; }
    function isIsoDate(s){ return typeof s === "string" && /^\\d{4}-\\d{2}-\\d{2}$/.test(s); }
    function quarterLabel(dateStr){
      if(!isIsoDate(dateStr)) return null;
      const [y,m] = dateStr.split("-").map(n=>parseInt(n,10));
      const q = Math.floor((m-1)/3)+1;
      return `${y} Q${q}`;
    }
    function addMonths(d, m){
      const x = new Date(d.getTime());
      x.setMonth(x.getMonth()+m);
      return x;
    }
    function nowQuarter(){
      const d = new Date();
      const y = d.getFullYear();
      const q = Math.floor(d.getMonth()/3)+1;
      return `${y} Q${q}`;
    }
    function nextQuarters(n=8){
      const out=[];
      const d=new Date();
      // start at current quarter
      const startMonth = Math.floor(d.getMonth()/3)*3;
      const start = new Date(d.getFullYear(), startMonth, 1);
      for(let i=0;i<n;i++){
        const dt = addMonths(start, i*3);
        const y=dt.getFullYear();
        const q=Math.floor(dt.getMonth()/3)+1;
        out.push(`${y} Q${q}`);
      }
      return out;
    }

    function pkgHasScope(p, scope){
      return (p.admin_tags?.kohdistus||[]).includes(scope);
    }

    // Intensity 1–5 derived from themes (scope aware). Simple, consistent.
    function intensity(p, scope){
      const themes = (p.themes||[]).filter(t => (t.scope||[]).includes(scope));
      let s=0;
      for(const t of themes){
        const d=(t.direction||"").toLowerCase();
        if(d.includes("kuormittava")) s+=2;
        else if(d.includes("sekavaikutus")) s+=1;
        else if(d.includes("keventävä")) s-=1;
      }
      s = Math.max(0, s) + Math.min(2, themes.length); // + small “volume” factor
      // map to 1..5
      if(s>=9) return 5;
      if(s>=6) return 4;
      if(s>=4) return 3;
      if(s>=2) return 2;
      return 1;
    }

    function levelClass(v){
      if(v>=4) return "high";
      if(v>=3) return "mid";
      return "low";
    }

    function primaryDate(p){
      // prefer earliest ISO event date
      const ds = (p.events||[]).map(e=>e.date).filter(isIsoDate).sort();
      return ds[0] || null;
    }

    function inNextMonths(dateStr, months){
      if(!isIsoDate(dateStr)) return false;
      const d = new Date(dateStr+"T00:00:00");
      const now = new Date();
      const limit = addMonths(now, months);
      return d >= now && d <= limit;
    }

    let allPkgs=[];
    let selectedScope=""; // filter
    let selectedSector="";
    let qText="";

    function matchesFilters(p){
      const text = (qText||"").toLowerCase().trim();
      const title=(p.title||"").toLowerCase();
      const desc=(p.description||"").toLowerCase();
      const sectors=(p.admin_tags?.sektorit||[]);
      const scopes=(p.admin_tags?.kohdistus||[]);
      if(text && !(title.includes(text) || desc.includes(text))) return false;
      if(selectedSector && !sectors.includes(selectedSector)) return false;
      if(selectedScope && !scopes.includes(selectedScope)) return false;
      return true;
    }

    function renderList(){
      const items = allPkgs
        .filter(matchesFilters)
        .map(p=>{
          const d = primaryDate(p);
          const dateLabel = d ? `Voimaan / virstanpylväs: ${d}` : "Ajankohta: —";
          const scopeForScore = selectedScope || (p.admin_tags?.kohdistus||[])[0] || "Kunnat";
          const score = intensity(p, scopeForScore);
          const cls = score>=4 ? "high" : (score<=2 ? "low" : "");
          const tags = []
            .concat((p.admin_tags?.sektorit||[]).slice(0,2).map(x=>`<span class="tag">${x}</span>`))
            .concat((p.admin_tags?.kohdistus||[]).slice(0,2).map(x=>`<span class="tag">${x}</span>`))
            .join("");

          return `
            <div class="item" onclick="location.href='./index.html?id=${p.package_id}'">
              <div class="itemTop">
                <div>
                  <div class="itemTitle">${p.title || p.package_id}</div>
                  <div class="itemMeta">${dateLabel}</div>
                </div>
                <div class="score ${cls}">${score}/5</div>
              </div>
              <div class="tagRow">${tags}</div>
            </div>
          `;
        });

      $("list").className="";
      $("list").innerHTML = `<div class="list">${items.length?items.join(""):`<div class="loading">Ei osumia suodattimilla.</div>`}</div>`;
    }

    function renderTimeline(){
      const qs = nextQuarters(8);
      const scopes = ["Kunnat","Hyvinvointialueet"];

      // compute quarter intensity per scope
      const bucket = {}; // scope -> q -> score sum (normalized later)
      for(const s of scopes){
        bucket[s]={};
        for(const q of qs) bucket[s][q]=0;
      }

      for(const p of allPkgs){
        if(!matchesFilters(p)) continue;
        const sectors=(p.admin_tags?.sektorit||[]);
        if(selectedSector && !sectors.includes(selectedSector)) continue;

        // quarter presence: any event in quarter
        const qset = new Set((p.events||[]).map(e=>quarterLabel(e.date)).filter(Boolean));
        for(const scope of scopes){
          if(!pkgHasScope(p, scope)) continue;
          for(const q of qs){
            if(qset.has(q)){
              bucket[scope][q] += intensity(p, scope);
            }
          }
        }
      }

      // normalize each scope into 1..5 relative within view
      const norm = {};
      for(const scope of scopes){
        const vals = qs.map(q=>bucket[scope][q]);
        const max = Math.max(1, ...vals);
        norm[scope] = qs.map(q=>{
          const v = bucket[scope][q];
          const scaled = Math.round((v/max)*5);
          return Math.max(1, scaled || 1);
        });
      }

      const makeRow = (scopeLabel, scopeKey) => {
        const bars = qs.map((q, i)=>{
          const v = norm[scopeKey][i];
          const cls = levelClass(v);
          return `
            <div class="qbar ${cls}" data-q="${q}" data-s="${scopeKey}">
              <div class="q">${q}</div>
              <div class="v">${v}/5</div>
              <div class="sub">samanaikaisuus</div>
            </div>
          `;
        }).join("");
        return `<div class="timeline"><div class="rowLabel">${scopeLabel}</div><div class="bars">${bars}</div></div>`;
      };

      $("timeline").className="";
      $("timeline").innerHTML = makeRow("Kunnat","Kunnat") + `<div style="height:10px"></div>` + makeRow("HVA","Hyvinvointialueet");

      // click highlight -> drill in heatmap panel
      document.querySelectorAll(".qbar").forEach(el=>{
        el.addEventListener("click", ()=>{
          document.querySelectorAll(".qbar").forEach(x=>x.classList.remove("on"));
          el.classList.add("on");
          // auto set nowLabel as selected quarter
          $("nowLabel").textContent = `Valittu: ${el.getAttribute("data-q")} • ${el.getAttribute("data-s")}`;
        });
      });
    }

    function renderHeatmap(){
      const sectors = ["SOTE","Koulutus","Työllisyys","Ilmasto","Digitalisaatio"];
      const rows = ["Hallinnonalat","Kunnat","Hyvinvointialueet"];

      const qNow = nowQuarter();
      $("nowLabel").textContent = `Nyt: ${qNow} (lähikuukaudet)`;

      // compute cell score: max intensity among packages matching row+sector with event within next 6 months
      const cellScore = {}; // row -> sector -> 1..5
      const cellPkgs = {};  // row -> sector -> list
      for(const r of rows){
        cellScore[r]={}; cellPkgs[r]={};
        for(const s of sectors){ cellScore[r][s]=1; cellPkgs[r][s]=[]; }
      }

      for(const p of allPkgs){
        if(!matchesFilters(p)) continue;
        const pSectors = (p.admin_tags?.sektorit||[]);
        const pScopes = (p.admin_tags?.kohdistus||[]);
        const d = primaryDate(p);
        // “now” = any event within next 6 months
        const inNow = (p.events||[]).some(e=>inNextMonths(e.date,6)) || (d && inNextMonths(d,6));
        if(!inNow) continue;

        for(const sec of sectors){
          if(!pSectors.includes(sec)) continue;
          // map row->scope key
          const pairs = [
            ["Hallinnonalat","Valtio"],
            ["Kunnat","Kunnat"],
            ["Hyvinvointialueet","Hyvinvointialueet"]
          ];
          for(const [row, scope] of pairs){
            if(!pScopes.includes(scope)) continue;
            const v = intensity(p, scope);
            if(v >= cellScore[row][sec]){
              cellScore[row][sec] = v;
            }
            cellPkgs[row][sec].push(p);
          }
        }
      }

      // build grid
      let html = `<div class="heat">`;
      html += `<div></div>`;
      for(const sec of sectors) html += `<div class="h">${sec}</div>`;
      for(const row of rows){
        html += `<div class="r">${row}</div>`;
        for(const sec of sectors){
          const v = cellScore[row][sec];
          const cls = levelClass(v);
          html += `<div class="cell ${cls}" data-row="${row}" data-sec="${sec}">${v}/5</div>`;
        }
      }
      html += `</div>`;

      $("heat").className="";
      $("heat").innerHTML = html;

      // drill click
      document.querySelectorAll(".cell").forEach(el=>{
        el.addEventListener("click", ()=>{
          document.querySelectorAll(".cell").forEach(x=>x.classList.remove("on"));
          el.classList.add("on");
          const row = el.getAttribute("data-row");
          const sec = el.getAttribute("data-sec");
          const pkgs = (cellPkgs[row][sec]||[]).slice(0,10);

          $("drillTitle").textContent = `${row} • ${sec}`;
          $("drillList").innerHTML = pkgs.length
            ? pkgs.map(p=>`<div class="drillItem"><a href="./index.html?id=${p.package_id}"><b>${p.title}</b></a> <small>(${p.package_id})</small></div>`).join("")
            : `<div class="small">Ei osumia lähikuukausille tässä sektorissa.</div>`;
        });
      });
    }

    async function loadAll(){
      const pkgs=[];
      for(const id of PACKAGES){
        try{
          const r = await fetch(`${DATA_DIR}${id}.json`, {cache:"no-cache"});
          if(!r.ok) continue;
          pkgs.push(await r.json());
        }catch(e){}
      }
      allPkgs = pkgs;

      renderList();
      renderTimeline();
      renderHeatmap();
    }

    function wire(){
      $("q").addEventListener("input", (e)=>{ qText=e.target.value; renderList(); renderTimeline(); renderHeatmap(); });
      $("sector").addEventListener("change", (e)=>{ selectedSector=e.target.value; renderList(); renderTimeline(); renderHeatmap(); });

      document.querySelectorAll("[data-scope]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          document.querySelectorAll("[data-scope]").forEach(x=>x.classList.remove("on"));
          btn.classList.add("on");
          selectedScope = btn.getAttribute("data-scope");
          renderList(); renderTimeline(); renderHeatmap();
        });
      });
    }

    wire();
    loadAll();
  </script>
</body>
</html>
